<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bomber Hero Pro</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { background: #000; color: #fff; font-family: 'Courier New', monospace; text-align: center; overflow: hidden; }
        #game-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; width: 100vw; }
        canvas { background: #1a1a1a; border: 3px solid #444; display: block; margin: 5px auto; touch-action: none; image-rendering: pixelated; }
        .ui-header { font-size: 12px; margin: 5px; color: #f1c40f; display: flex; gap: 15px; }
        .dpad { display: grid; grid-template-columns: repeat(3, 75px); grid-gap: 12px; margin-top: 10px; }
        .btn { width: 75px; height: 75px; background: #34495e; color: #fff; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-weight: bold; border-bottom: 6px solid #1a252f; cursor: pointer; user-select: none; }
        .btn:active { border-bottom: 0; transform: translateY(4px); background: #2c3e50; }
        #bomb-btn { background: #e74c3c; border-bottom-color: #c0392b; }
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .card { background: #2c3e50; border: 2px solid #3498db; padding: 15px; margin: 10px; width: 85%; border-radius: 15px; cursor: pointer; }
        .card b { font-size: 18px; color: #f1c40f; }
        .card p { font-size: 11px; margin-top: 5px; color: #bdc3c7; }
    </style>
</head>
<body>

<div id="overlay">
    <h1 style="color:#e74c3c; margin-bottom:10px;">BOMBER HERO PRO</h1>
    <div class="card" onclick="init('Classic', 5, 2, true, false)">
        <b>CLASSIC</b>
        <p>HP: 5 | RANGE: 2 | ABILITY: BOMB KICK</p>
    </div>
    <div class="card" onclick="init('Ninja', 2, 3, false, true)">
        <b>NINJA</b>
        <p>HP: 2 | RANGE: 3 | ABILITY: PHASE BRICKS</p>
    </div>
    <div class="card" onclick="init('Tank', 10, 5, false, false)">
        <b>TANK</b>
        <p>HP: 10 | RANGE: 5 | ABILITY: BULKY FORCE</p>
    </div>
</div>

<div id="game-container">
    <div class="ui-header">
        <span>LVL: <b id="st">1</b></span>
        <span>HP: <b id="hp" style="color:#e74c3c">0</b></span>
        <span>ENEMIES: <b id="en">0</b></span>
    </div>
    
    <canvas id="gameCanvas"></canvas>

    <div class="dpad">
        <div></div><div class="btn" onclick="move(0,-1)">UP</div><div></div>
        <div class="btn" onclick="move(-1,0)">LEFT</div><div class="btn" id="bomb-btn" onclick="drop()">BOMB</div><div class="btn" onclick="move(1,0)">RIGHT</div>
        <div></div><div class="btn" onclick="move(0,1)">DOWN</div><div></div>
    </div>
</div>

<script>
    var canvas = document.getElementById('gameCanvas');
    var ctx = canvas.getContext('2d');
    var TILE = 32, COLS = 11, ROWS = 11;
    canvas.width = COLS * TILE; canvas.height = ROWS * TILE;

    var grid = [], bombs = [], enemies = [], explosions = [];
    var player = { x: 1, y: 1, hp: 0, inv: 0, range: 2, canKick: false, canPhase: false };
    var stage = 1, active = false;

    function init(type, hp, range, kick, phase) {
        player.hp = hp; player.range = range; player.canKick = kick; player.canPhase = phase;
        player.x = 1; player.y = 1; player.inv = 0;
        stage = 1; buildLevel();
        document.getElementById('overlay').style.display = 'none';
        active = true;
    }

    function buildLevel() {
        grid = []; bombs = []; enemies = []; explosions = [];
        for (var r = 0; r < ROWS; r++) {
            grid[r] = [];
            for (var c = 0; c < COLS; c++) {
                if (r === 0 || r === ROWS - 1 || c === 0 || c === COLS - 1 || (r % 2 === 0 && c % 2 === 0)) grid[r][c] = 1;
                else grid[r][c] = (Math.random() < 0.3 && !(r < 3 && c < 3)) ? 2 : 0;
            }
        }
        // Hidden Exit Door
        var bricks = [];
        for(var r=0; r<ROWS; r++) for(var c=0; c<COLS; c++) if(grid[r][c]===2) bricks.push({r,c});
        if(bricks.length) grid[bricks[0].r][bricks[0].c] = 4;

        // Spawn Variable Enemies
        for(var i=0; i < (stage + 1); i++) {
            var rx, ry; do { rx = Math.floor(Math.random()*COLS); ry = Math.floor(Math.random()*ROWS); }
            while(grid[ry][rx] !== 0 || (rx < 4 && ry < 4));
            enemies.push({x: rx, y: ry, dx: 1, dy: 0, t: 0, intelligent: Math.random() > 0.5});
        }
    }

    function move(dx, dy) {
        if(!active) return;
        var nx = player.x + dx, ny = player.y + dy;
        
        // Complex Logic: Bomb Kicking
        var bAt = bombs.find(function(b){ return b.x === nx && b.y === ny; });
        if(bAt && player.canKick) {
            slideBomb(bAt, dx, dy); return;
        } else if(bAt) return;

        if (grid[ny][nx] === 0 || grid[ny][nx] === 3) {
            player.x = nx; player.y = ny;
            if(grid[ny][nx] === 3 && enemies.length === 0) { stage++; buildLevel(); }
        } else if (player.canPhase && (grid[ny][nx] === 2 || grid[ny][nx] === 4)) {
            player.x = nx; player.y = ny;
        }
    }

    function slideBomb(b, dx, dy) {
        var kickMove = setInterval(function() {
            var nx = b.x + dx, ny = b.y + dy;
            if(grid[ny][nx] === 0 && !bombs.find(function(ob){ return ob.x === nx && ob.y === ny; })) {
                b.x = nx; b.y = ny;
            } else { clearInterval(kickMove); }
        }, 100);
    }

    function drop() {
        if(!active || bombs.length > 2) return;
        if(!bombs.find(function(b){ return b.x === player.x && b.y === player.y; })) {
            bombs.push({x: player.x, y: player.y, t: 120});
        }
    }

    function boom(bx, by) {
        var dirs = [[0,0],[0,1],[0,-1],[1,0],[-1,0]];
        dirs.forEach(function(d) {
            for(var i=0; i <= player.range; i++) {
                if(i > 0 && d[0] === 0 && d[1] === 0) continue;
                var ex = bx + d[0]*i, ey = by + d[1]*i;
                if(grid[ey][ex] === 1) break;
                explosions.push({x: ex, y: ey, l: 15});
                if(grid[ey][ex] === 2 || grid[ey][ex] === 4) {
                    grid[ey][ex] = (grid[ey][ex] === 4) ? 3 : 0; break;
                }
                enemies = enemies.filter(function(e){ return e.x !== ex || e.y !== ey; });
                if(player.x === ex && player.y === ey) hurt();
            }
        });
    }

    function hurt() {
        if(player.inv > 0) return;
        player.hp--; player.inv = 60;
        if(player.hp <= 0) location.reload();
    }

    function loop() {
        ctx.fillStyle = "#1a1a1a"; ctx.fillRect(0, 0, canvas.width, canvas.height);
        if(active) {
            for(var r=0; r<ROWS; r++) {
                for(var c=0; c<COLS; c++) {
                    var x = c*TILE, y = r*TILE;
                    if(grid[r][c] === 1) ctx.fillStyle = "#444";
                    else if(grid[r][c] === 2 || grid[r][c] === 4) ctx.fillStyle = "#a64";
                    else if(grid[r][c] === 3) ctx.fillStyle = "#2ecc71";
                    else ctx.fillStyle = "#222";
                    ctx.fillRect(x, y, TILE-1, TILE-1);
                }
            }
            ctx.fillStyle = "#fff"; bombs.forEach(function(b, i) {
                ctx.beginPath(); ctx.arc(b.x*TILE+16, b.y*TILE+16, 12, 0, 7); ctx.fill();
                b.t--; if(b.t <= 0) { boom(b.x, b.y); bombs.splice(i, 1); }
            });
            ctx.fillStyle = "rgba(255,100,0,0.7)"; explosions.forEach(function(x, i) {
                ctx.fillRect(x.x*TILE, x.y*TILE, TILE, TILE);
                x.l--; if(x.l <= 0) explosions.splice(i, 1);
            });
            enemies.forEach(function(e) {
                ctx.fillStyle = e.intelligent ? "#f1c40f" : "#e74c3c";
                ctx.fillRect(e.x*TILE+6, e.y*TILE+6, 20, 20);
                e.t++; if(e.t > 35) {
                    var nx = e.x + e.dx, ny = e.y + e.dy;
                    if(grid[ny][nx] === 0 && !bombs.find(function(b){ return b.x === nx && b.y === ny; })) {
                        e.x = nx; e.y = ny;
                    } else {
                        var nd = [[0,1],[0,-1],[1,0],[-1,0]][Math.floor(Math.random()*4)];
                        e.dx = nd[0]; e.dy = nd[1];
                    } e.t = 0;
                }
                if(e.x === player.x && e.y === player.y) hurt();
            });
            if(player.inv % 6 < 3) {
                ctx.fillStyle = player.canPhase ? "#2ecc71" : "#3498db";
                ctx.fillRect(player.x*TILE+6, player.y*TILE+6, 20, 20);
            }
            if(player.inv > 0) player.inv--;
            document.getElementById('hp').innerText = player.hp;
            document.getElementById('st').innerText = stage;
            document.getElementById('en').innerText = enemies.length;
        }
        requestAnimationFrame(loop);
    }
    loop();
</script>
</body>
</html>
