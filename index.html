<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bomber Hero Mobile</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { background: #000; color: #fff; font-family: sans-serif; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        
        #ui { width: 100%; max-width: 400px; padding: 10px; display: flex; justify-content: space-between; background: #222; font-size: 14px; border-bottom: 2px solid #444; }
        
        canvas { background: #2c3e50; display: block; border: 2px solid #555; margin: 5px 0; touch-action: none; }

        /* EXTRA LARGE MOBILE CONTROLS */
        .controls { display: grid; grid-template-columns: repeat(3, 85px); grid-gap: 12px; padding: 10px; margin-top: 5px; }
        .btn { width: 85px; height: 85px; background: #34495e; border-radius: 15px; display: flex; align-items: center; justify-content: center; user-select: none; border-bottom: 6px solid #1a252f; cursor: pointer; font-weight: bold; font-size: 16px; }
        .btn:active { border-bottom: 0; transform: translateY(4px); background: #2c3e50; }
        #bomb-btn { background: #e74c3c; border-bottom-color: #c0392b; font-size: 14px; }

        #overlay { position: fixed; inset: 0; background: #111; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .card { background: #2c3e50; padding: 20px; margin: 10px; border-radius: 15px; width: 100%; max-width: 320px; text-align: center; border: 2px solid #555; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .card b { font-size: 18px; display: block; margin-bottom: 5px; }
    </style>
</head>
<body>

<div id="overlay">
    <h1 style="margin-bottom:20px; color:#f1c40f;">BOMBER HERO</h1>
    <div class="card" onclick="forceStart('Knight', 5, 2, '#3498db')">
        <b>BLUE KNIGHT</b>
        <small>HP: 5 | POWER: BOMB KICK</small>
    </div>
    <div class="card" onclick="forceStart('Ninja', 2, 3, '#2ecc71')">
        <b>GREEN NINJA</b>
        <small>HP: 2 | POWER: PHASE WALLS</small>
    </div>
    <div class="card" onclick="forceStart('Wizard', 3, 6, '#9b59b6')">
        <b>PURPLE WIZARD</b>
        <small>HP: 3 | POWER: REMOTE BOMB</small>
    </div>
</div>

<div id="ui">
    <div id="st">STAGE: 1</div>
    <div id="hp" style="color:#ff7675">HP: -</div>
    <div id="en">ENEMIES: -</div>
</div>

<canvas id="gameCanvas"></canvas>

<div class="controls">
    <div></div><div class="btn" onclick="move(0,-1)">UP</div><div></div>
    <div class="btn" onclick="move(-1,0)">LEFT</div><div class="btn" id="bomb-btn" onclick="handleBomb()">BOMB</div><div class="btn" onclick="move(1,0)">RIGHT</div>
    <div></div><div class="btn" onclick="move(0,1)">DOWN</div><div></div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const TILE = 32, ROWS = 11, COLS = 11;
    canvas.width = COLS * TILE;
    canvas.height = ROWS * TILE;

    let G = [], B = [], E = [], X = [];
    let P = { x: 1, y: 1, hp: 0, range: 2, type: '', inv: 0, color: 'blue' };
    let stage = 1, active = false;

    function forceStart(type, hp, range, color) {
        P.type = type; P.hp = hp; P.range = range; P.color = color;
        P.x = 1; P.y = 1; P.inv = 0;
        document.getElementById('overlay').style.display = 'none';
        buildLevel();
        active = true;
    }

    function buildLevel() {
        G = []; B = []; E = []; X = [];
        for (let r = 0; r < ROWS; r++) {
            G[r] = [];
            for (let c = 0; c < COLS; c++) {
                if (r === 0 || r === ROWS - 1 || c === 0 || c === COLS - 1 || (r % 2 === 0 && c % 2 === 0)) {
                    G[r][c] = 1;
                } else {
                    G[r][c] = (Math.random() < 0.3 && !(r < 3 && c < 3)) ? 2 : 0;
                }
            }
        }
        
        let bricks = [];
        for(let r=0; r<ROWS; r++) for(let c=0; c<COLS; c++) if(G[r][c]===2) bricks.push({r,c});
        if(bricks.length) { 
            let d = bricks[Math.floor(Math.random()*bricks.length)]; 
            G[d.r][d.c] = 4; // Door location
        }

        for(let i=0; i<stage+1; i++) {
            let rx, ry; 
            do { rx=Math.floor(Math.random()*COLS); ry=Math.floor(Math.random()*ROWS); }
            while(G[ry][rx]!==0 || (rx<4 && ry<4));
            E.push({x:rx, y:ry, dx:1, dy:0, t:0});
        }
    }

    function move(dx, dy) {
        if(!active) return;
        let nx = P.x + dx, ny = P.y + dy;
        if(nx < 0 || nx >= COLS || ny < 0 || ny >= ROWS) return;
        
        let cell = G[ny][nx];
        if(cell === 1) return;
        
        // Bomb kick logic for Knight
        let bomb = B.find(b => b.x === nx && b.y === ny);
        if(bomb && P.type === 'Knight') {
            slideBomb(bomb, dx, dy);
            return;
        } else if (bomb) return;

        // Ninja Phasing
        if((cell === 2 || cell === 4) && P.type !== 'Ninja') return;
        
        P.x = nx; P.y = ny;
        if(cell === 3 && E.length === 0) { stage++; buildLevel(); }
    }

    function slideBomb(b, dx, dy) {
        let si = setInterval(() => {
            let nx = b.x + dx, ny = b.y + dy;
            if(G[ny] && G[ny][nx] === 0 && !B.find(ob => ob.x === nx && ob.y === ny)) {
                b.x = nx; b.y = ny;
            } else { clearInterval(si); }
        }, 100);
    }

    function handleBomb() {
        if(!active) return;
        if(P.type === 'Wizard' && B.length > 0) {
            let b = B.shift(); triggerExplosion(b.x, b.y);
        } else if(B.length < 3) {
            if(!B.find(b => b.x === P.x && b.y === P.y)) {
                B.push({x: P.x, y: P.y, t: 120});
            }
        }
    }

    function triggerExplosion(bx, by) {
        let ds = [[0,0],[0,1],[0,-1],[1,0],[-1,0]];
        ds.forEach(d => {
            for(let i=0; i<=P.range; i++) {
                if(i>0 && d[0]===0 && d[1]===0) continue;
                let ex = bx + d[0]*i, ey = by + d[1]*i;
                if(ex<0 || ex>=COLS || ey<0 || ey>=ROWS || G[ey][ex] === 1) break;
                
                X.push({x:ex, y:ey, l:15});
                
                if(G[ey][ex] === 2 || G[ey][ex] === 4) {
                    G[ey][ex] = (G[ey][ex] === 4) ? 3 : 0;
                    break;
                }
                E = E.filter(e => e.x !== ex || e.y !== ey);
                if(P.x === ex && P.y === ey) hit();
            }
        });
    }

    function hit() {
        if(P.inv > 0) return;
        P.hp--; P.inv = 60;
        if(P.hp <= 0) {
            active = false;
            alert("GAME OVER! Stage reached: " + stage);
            location.reload();
        }
    }

    function draw() {
        ctx.fillStyle = '#2c3e50'; 
        ctx.fillRect(0,0,canvas.width,canvas.height);
        
        if(!active) { requestAnimationFrame(draw); return; }

        for(let r=0; r<ROWS; r++) {
            for(let c=0; c<COLS; c++) {
                let x=c*TILE, y=r*TILE;
                if(G[r][c] === 1) { ctx.fillStyle='#111'; ctx.fillRect(x,y,TILE,TILE); }
                else if(G[r][c] === 2 || G[r][c] === 4) { 
                    ctx.fillStyle = P.type === 'Ninja' ? 'rgba(150,75,0,0.5)' : '#964b00'; 
                    ctx.fillRect(x+1,y+1,TILE-2,TILE-2); 
                }
                else if(G[r][c] === 3) { ctx.fillStyle='#2ecc71'; ctx.fillRect(x+10,y+10,12,12); }
            }
        }

        ctx.fillStyle='#000'; 
        B.forEach(b => {
            ctx.beginPath(); ctx.arc(b.x*TILE+16, b.y*TILE+16, 12, 0, 7); ctx.fill();
        });

        ctx.fillStyle='rgba(255,165,0,0.8)'; 
        X.forEach(x => ctx.fillRect(x.x*TILE, x.y*TILE, TILE, TILE));

        ctx.fillStyle='#e74c3c'; 
        E.forEach(e => ctx.fillRect(e.x*TILE+8, e.y*TILE+8, 16, 16));
        
        if(P.inv % 6 < 3) { 
            ctx.fillStyle = P.color; 
            ctx.fillRect(P.x*TILE+6, P.y*TILE+6, 20, 20); 
        }

        // Logic Updates
        if(P.type !== 'Wizard') {
            B.forEach((b,i) => { b.t--; if(b.t<=0) { triggerExplosion(b.x, b.y); B.splice(i,1); } });
        }
        X.forEach((x,i) => { x.l--; if(x.l<=0) X.splice(i,1); });
        if(P.inv > 0) P.inv--;
        
        E.forEach(e => {
            e.t++; if(e.t > 45) {
                let nx=e.x+e.dx, ny=e.y+e.dy;
                if(G[ny] && G[ny][nx]===0) { e.x=nx; e.y=ny; }
                else { e.dx = Math.random()>0.5?1:-1; e.dy = e.dx===0?(Math.random()>0.5?1:-1):0; }
                e.t=0;
            }
            if(e.x===P.x && e.y===P.y) hit();
        });

        document.getElementById('hp').innerText = "HP: " + P.hp;
        document.getElementById('st').innerText = "STAGE: " + stage;
        document.getElementById('en').innerText = "ENEMIES: " + E.length;

        requestAnimationFrame(draw);
    }
    draw();
</script>
</body>
</html>
